<!DOCTYPE html>
<html>
    <head>
            <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
        <title>Timer</title>
        <link rel="stylesheet" type="text/css" href="css/jquery.mobile-1.4.5.min.css" />
        <script src="js/jquery-1.11.1.min.js"></script>
        <script src="js/jquery.mobile-1.4.5.min.js"></script>
        <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
        <script src="js/jquery.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
       <!-- <link rel="stylesheet/less" type="text/css" href="styles.less" />
        <script src="less.min.js" ></script> -->
       <script>
           $(document).ready(function(){
               
              
            var db,time,speech,name,min,max,warn,agenda,g,a,r,buzz,buzz1,buzz2,b1,b2;
        document.addEventListener("deviceready", onDeviceReady, false);
function onDeviceReady() { 
    
   var macAddress="20:18:07:13:58:62";
    window.plugins.sqlDB.copy("toastmasters.db",0,copysuccess,copyerror);
    
 bluetoothSerial.connectInsecure(macAddress,
                         function(){
     alert('Bluetooth connected');
 },
                        function(){
     
     bluetoothSerial.connectInsecure(macAddress,
                         function(){
     alert('Bluetooth connected');
 },
                        function(){
    /*alert('not connected');*/
 });
 });
          
   
}
               
   function copysuccess(){
        
    db = window.sqlitePlugin.openDatabase({name: "toastmasters.db",location:'default'});
        db.transaction(queryDB, errorCB);
}
               
function copyerror(e){
   /* alert('errorCE : '+JSON.stringify(e));*/
    db = window.sqlitePlugin.openDatabase({name: "toastmasters.db",location:'default'});
    db.transaction(queryDB, errorCB);
}
 

function queryDB(transaction){
    
     db.transaction(function(transaction) {
    var executeQuery = "SELECT * FROM MEETING_AGENDA WHERE FLAG IS NULL";
    transaction.executeSql(executeQuery, [],
      //On Success
      function(transaction, result) {
                           var len = result.rows.length;
        
                            agenda=result.rows.item(0).AGENDA_ITEM_NO;
                            speech=result.rows.item(0).SPEECH_TYPE_DESCRIPTION;
                            document.getElementById("speech").innerHTML=speech;
                            name= result.rows.item(0).TOASTMASTER_NAME;
                            document.getElementById("name").innerHTML=name;
                            
        }, 
      //On Error
      function(error){alert('Something went Wrong');}); 
  });
    
    db.transaction(function(transaction) {
    var executeQuery = "SELECT * FROM SPEECH_TYPE WHERE SPEECH_TYPE_DESCRIPTION=?";
    transaction.executeSql(executeQuery, [speech],
      //On Success
      function(transaction, result) {
                        min  = Number(result.rows.item(0).MINIMUM_TIME)*60*1000;
                        max  = Number(result.rows.item(0).MAXIMUM_TIME)*60*1000;
                        warn = Number(result.rows.item(0).WARNING_TIME)*60*1000;
                        buzz = max+30000;   
                        buzz1=buzz+30000;
                        buzz2=buzz1+30000;
                        
            }, 
      //On Error
      function(error){alert('Something went Wrong');});
  });
    
  
$("#btns").click(function(){
    alert("started");
    
var tim=new Date($.now());
     time = tim.getHours() + ":" + tim.getMinutes() + ":" + tim.getSeconds();
    alert('Actual Start time: '+time);
    
  db.transaction(function(transaction) {
    var executeQuery = "UPDATE MEETING_AGENDA SET ACTUAL_START_TIME =? WHERE AGENDA_ITEM_NO =?";
    transaction.executeSql(executeQuery, [time,agenda],
      //On Success
      function(transaction, result) {alert('Actual Start TIme Updated successfully');
                           
                           
                           }, 
      //On Error
      function(error){alert('Something went Wrong');});
  });
    
     g=setTimeout(function(){
                    bluetoothSerial.write("G",function(){/*alert('green');*/},function(){alert('not green');});
                    
}, min);
     a=setTimeout(function(){ 
                             bluetoothSerial.write("Y",
                                          function(){
                                /* alert('amber');*/
                        
                    },
                                          function(){
                        alert('amber not');
                    });}, warn);
     r=setTimeout(function(){  
                             bluetoothSerial.write("R",
                                          function(){
                                /* alert('red');*/
                        
                    },
                                          function(){
                        alert('red not');
                    });}, max);
     b=setTimeout(function(){ 
                             bluetoothSerial.write("B",
                                          function(){
                        
                    },
                                          function(){
                        alert('buz  not');
                    });},buzz);
     b1=setTimeout(function(){ 
                              bluetoothSerial.write("B",
                                          function(){
                        
                    },
                                          function(){
                        alert('green not');
                    });},buzz1);
     b2=setTimeout(function(){ 
                              bluetoothSerial.write("B",
                                          function(){
                        
                    },
                                          function(){
                        alert('green not');
                    });},buzz2);
    

    });
    $("#btnst").click(function(){
        alert('stopped');
         bluetoothSerial.write("O",
                                          function(){
                       /* alert('OFF');*/
                    },
                                          function(){
                        alert('not OFF');
                    });
        clearTimeout(g);
        clearTimeout(a);
        clearTimeout(r);
        clearTimeout(b);
        clearTimeout(b1);
        clearTimeout(b2);
        tim1= new Date($.now());
        time1=tim1.getHours()+':' +tim1.getMinutes() +':' +tim1.getSeconds();
        alert(time1);
        var Q=1;
        db.transaction(function(transaction){
            var executeQuery="UPDATE MEETING_AGENDA SET ACTUAL_END_TIME=?,FLAG=? WHERE AGENDA_ITEM_NO=?";
            transaction.executeSql(executeQuery,[time1,Q,agenda],
                function(tx,result){alert('updated');
                                   },
                function(error){
                alert('Something went Wrong');
            });
        });
       /* var dur=(tim1.getHours()-tim.getHours())+':'+(tim1.getMinutes()-tim.getMinutes())+':'+(tim1.getSeconds()-tim.getSeconds());
        alert('duration of the speech is'+dur); */
    });
   
        
    }
    

function errorCB(err) {
  alert("Error processing SQL : "+err.message);
} 

 });
</script>
        <style>
        @import url('https://fonts.googleapis.com/css?family=Encode+Sans+Condensed:400,600');

* {
  outline: none;
}

strong {
  font-weight: 600;
}

.page {
  width: 100%;
  height: 100vh;
 font-family: 'Encode Sans Condensed', sans-serif;
  font-weight: 600;
  letter-spacing: .03em;
  color: #000;
    z-index: -1;
}

header {
  display: flex;
  position: fixed;
  width: 100%;
  height: 70px;
  background: #000;
  color: #fff;
  justify-content: center;
  align-items: center;
  -webkit-tap-highlight-color: rgba(0,0,0,0);
}

main {
  padding: 70px 20px 0;
  display: flex;
  flex-direction: column;
  height: 100%;
   background: #e6e6e6;
}

main > div {
  margin: auto;
  max-width: 600px;
}

main p {
  line-height: normal;
  font-weight: 400;
}



#nav-container {
  position: fixed;
  height: 100vh;
  width: 100%;
  pointer-events: none;
    z-index: 1;
}
#nav-container .bg {
  position: absolute;
  top: 70px;
  left: 0;
  width: 100%;
  height: calc(100% - 70px);
  visibility: hidden;
  opacity: 0;
  transition: .3s;
  background: #000;
}
#nav-container:focus-within .bg {
  visibility: visible;
  opacity: .6;
}
#nav-container * {
  visibility: visible;
}

.button {
  position: relative;
  display: flex;
  flex-direction: column;
  justify-content: center;
  z-index: 1;
  -webkit-appearance: none;
  border: 0;
  background: transparent;
  border-radius: 0;
  height: 70px;
  width: 30px;
  cursor: pointer;
  pointer-events: auto;
  margin-left: 25px;
  touch-action: manipulation;
  -webkit-tap-highlight-color: rgba(0,0,0,0);
}
.icon-bar {
  display: block;
  width: 100%;
  height: 3px;
  background: #fff;
  transition: .3s;
}
.icon-bar + .icon-bar {
  margin-top: 5px;
}

#nav-container:focus-within .button {
  pointer-events: none;
}
#nav-container:focus-within .icon-bar:nth-of-type(1) {
  transform: translate3d(0,8px,0) rotate(45deg);
}
#nav-container:focus-within .icon-bar:nth-of-type(2) {
  opacity: 0;
}
#nav-container:focus-within .icon-bar:nth-of-type(3) {
  transform: translate3d(0,-8px,0) rotate(-45deg);
}

#nav-content {
  
  padding: 20px;
  width: 90%;
  max-width: 200px;
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  background: #000;
  pointer-events: auto;
  -webkit-tap-highlight-color: rgba(0,0,0,0);
  transform: translateX(-100%);
  transition: transform .3s;
  will-change: transform;
  contain: paint;
   z-index: 1; position:relative; 
}

#nav-content ul {
  height: 100%;
  display: flex;
  flex-direction: column;
}

#nav-content li a {
  padding: 10px 5px;
  display: block;
  text-transform: uppercase;
  transition: color .1s;
}

#nav-content li a:hover {
  color: #BF7497;
}

#nav-content li:not(.small) + .small {
  margin-top: auto;
}


#nav-container:focus-within #nav-content {
  transform: none;
}





* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html, body {
  height: 100%;
}

a,
a:visited,
a:focus,
a:active,
a:link {
  text-decoration: none;
  outline: 0;
}

a {
  color: currentColor;
  transition: .2s ease-in-out;
}



ul {
  padding: 0;
  list-style: none;
}

img {
  vertical-align: middle;
  height: auto;
  width: 100%;
}
    
.box{
            
                width:7px;
                height:6px;
                                
            }

            .green{
                background:#008000;
                margin:20px;
                margin-left: 35px;
            }
            .yellow{
                background: #FFE900;
                margin:20px;
                
            }
            .red{
                background:#C0392B;
                margin: 20px;
            }
            
            span.a {
                display: inline-block;
                width: 80px;
                height: 80px;
                padding: 5px;
                border: 1px solid limegreen;    
                background-color:limegreen;
                opacity :0.2;
                align-items: center;
            }

            span.b {
                display: inline-block;
                width: 80px;
                height: 80px;
                padding: 5px;
                border: 1px solid yellow;    
                background-color: yellow;
                opacity:0.2;
                align-items: center;
            }
            span.c {
                display: inline-block;
                width: 80px;
                height: 80px;
                padding: 5px;
                border: 1px solid red;    
                background-color: red;
                opacity:0.2;
                 
                align-items: center;
            }           
            #a1 {
                    margin 400px, 0px, 0px, 0px;
                    float: left;
                }

        /*    #b1 {
                    float: right;
                } */
            
        </style>

    </head>
    <body>
               <script type="text/javascript" src="cordova.js"></script>

    <div class="page">
        
        
  <header tabindex="0">Start Timer</header>
  <div id="nav-container">
    <div class="button" tabindex="0">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div id="nav-content" tabindex="0">
       <ul>
        <li><a href="index.html" rel="external">Home Page</a></li>
        <li><a href="3create_agenda.html" rel="external">Create Agenda</a></li>
        <li><a href="#0">View/Modify Agenda</a></li>
        <li><a href="4timer.html" rel="external">Start Timer</a></li>
        <li><a href="6edit_table_topic.html" rel="external">Edit Table Topic</a></li>
        <li><a href="#0">Report</a></li>
        <li><a href="9gen_info.html" rel="external">General Information</a></li>
        <li><a href="7add_new_toast.html" rel="external">Add Toastmaster</a></li>
        <li><a href="8add_speech_type.html" rel="external">Add Speech Type</a></li>  
        </ul>
    </div>
  </div>
  <main>
      
        <p id="a1"></p>
            
            <script>
                var d = new Date();
                var n = d.getDay();
                if(n==0)
                {
                    d.setDate(d.getDate() + 4);
                }
                else if(n==1)
                    {
                        d.setDate(d.etDate()+3);
                    }
                else if(n==2)
                    {
                        d.setDate(d.getDate()+2);
                    }
                else if(n==3)
                    {
                        d.setDate(d.getDate()+1);
                    }
                else if(n==5)
                    {
                        d.setDate(d.getDate()+6);
                    }
                else if(n==6)
                    {
                        d.setDate(d.getDate()+5)
                    }
                    document.getElementById("a1").innerHTML = d.toDateString();
            </script>
         
      
       <!-- <p id="b1">
        MEETING N0:123
        </p> -->
        
        <br/>
        Type of Speech:
            <p id="speech"></p>
        
      Name of the Speaker : 
       <p id="name"></p>
             
                <div class="form-row">
                    <button data-inline="true" id="btns">     Start     </button>
                    
                   <button data-inline="true" id="btnst">     Stop     </button>
      </div>
               <div class="form-row">
               <span data-inline="true" class="a"></span> 
               <span data-inline="true" class="b"></span>
               <span data-inline="true" class="c"></span>
                   
         </div>
                
                <div class="form-row">
                    <a href="4timer.html" rel="external" data-role="button" data-inline="true" id="nxbtn">Next</a>
                    <a href="4timer.html" rel="external" data-role="button" data-inline="true">Absent</a>
                    <a href="index.html" rel="external" data-role="button" data-inline="true">Adjourned</a>
                </div>
       
           </main>
           </div>
    </body>
</html>